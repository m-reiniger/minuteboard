/*! minuteboard 2014-10-29 */
var Base=function(){var a=$.cookie("username");a&&(this.poster=a)};Base.prototype.poster="",Base.prototype.submitForm=function(a,b){var c=a.find("input[name=poster]").val();this.poster=c,$.cookie("username",c),a.ajax(b)},Base.prototype.ajax=function(a,b,c){var d=null,e=null;$.ajax({url:a,data:b,type:"POST",dataType:"json",success:function(a){d=a},error:function(a,b,c){e=c},complete:function(){c(e,d)}})},Base.prototype.formatDate=function(a){var b=(new Date).getTime()/1e3-a,c=86400,d=3600,e=60;if(b>c){var f=Math.floor(b/c);return f>1?f+" days ago":f+" day ago"}if(b>d){var f=Math.floor(b/d);return f>1?f+" hours ago":f+" hour ago"}if(b>e){var f=Math.floor(b/e);return f>1?f+" minutes ago":f+" minute ago"}var f=Math.floor(b);return f>1?f+" seconds ago":f+" second ago"};
;
/*! minuteboard 2014-10-29 */
!function(a){a.fn.ajax=function(b){var c=this,d=c.serialize(),e=c.attr("action"),f=null,g=null;c.attr("slock")&&"false"!==c.attr("slock")||(c.attr("slock","true"),a.ajax({url:e,data:d,type:"POST",dataType:"json",success:function(a){f=a},error:function(a,b,c){g=c,alert("Sorry, there was a problem!")},complete:function(){c.attr("slock","false"),c[0].reset(),b&&b(g,f)}}))}}(jQuery);
;
/*! minuteboard 2014-10-29 */
var Blog=function(){this.init()};Blog.prototype=new Base,Blog.prototype.constructor=Blog,Blog.prototype.init=function(){var a=this;a.initForm(),a.loadMessages(),a.initFormEvents(),a.initMessageLoading(),a.initTimeDisplayTimer()},Blog.prototype.initForm=function(){var a=this;$("form#message").find("input[name=poster]").val(a.poster)},Blog.prototype.initFormEvents=function(){var a=this,b=$("form#message");b.bind("submit",function(c){return clearInterval(a.messageTimer),c.preventDefault(),a.submitForm(b,function(){a.initForm(),a.loadMessages(),a.initMessageLoading()}),!1})},Blog.prototype.initMessageLoading=function(){var a=this;a.messageTimer=window.setInterval(function(){a.loadMessages()},1e4)},Blog.prototype.initTimeDisplayTimer=function(){var a=this;window.setInterval(function(){a.refreshTimeDisplay()},1e3)},Blog.prototype.loadMessages=function(){var a=this,b=$("div.message:last-child"),c=b.attr("data-sec"),d=b.attr("data-usec");c||(c=0),d||(d=0),a.ajax("/blog/getMessages",{sec:c,usec:d},function(b,c){c&&c.forEach(function(b){var c=$("div#templates div.message").clone();c.attr("id",b._id.$id),c.attr("data-sec",b.created.sec),c.attr("data-usec",b.created.usec),c.find("span.poster").text(b.poster),c.find("span.time").text(a.formatDate(b.created.sec)),c.find("div.messagetext p").html(b.text.replace(/(\n)+/g,"</p><p>")),$("div.messages").append(c)})})},Blog.prototype.refreshTimeDisplay=function(){var a=this;$("div.messages div.message").each(function(){var b=$(this).attr("data-sec");$(this).find("span.time").text(a.formatDate(b))})};